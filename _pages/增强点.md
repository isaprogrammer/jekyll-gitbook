---
title: 增强点
author: Yalong Lee
date: 2025-06-29
category: Jekyll
layout: post
---

# mybatis-3.2

```java
package org.apache.ibatis.executor;

public abstract class BaseExecutor implements Executor {

    @Override
    public int update(MappedStatement ms, Object parameter) throws SQLException {
        ErrorContext.instance().resource(ms.getResource()).activity("executing an update").object(ms.getId());
        if (closed) {
            throw new ExecutorException("Executor was closed.");
        }
        clearLocalCache();
        return doUpdate(ms, parameter);
    }

    @Override
    public <E> List<E> query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {
        ErrorContext.instance().resource(ms.getResource()).activity("executing a query").object(ms.getId());
        if (closed) {
            throw new ExecutorException("Executor was closed.");
        }
        if (queryStack == 0 && ms.isFlushCacheRequired()) {
            clearLocalCache();
        }
        List<E> list;
        try {
            queryStack++;
            list = resultHandler == null ? (List<E>) localCache.getObject(key) : null;
            if (list != null) {
                handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);
            } else {
                list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);
            }
        } finally {
            queryStack--;
        }
        if (queryStack == 0) {
            for (DeferredLoad deferredLoad : deferredLoads) {
                deferredLoad.load();
            }
            // issue #601
            deferredLoads.clear();
            if (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) {
                // issue #482
                clearLocalCache();
            }
        }
        return list;
    }

}
```

# elasticsearch-7x

```java
package org.elasticsearch.client;

public class RestClient implements Closeable {
    
    private static HttpRequestBase createHttpRequest(String method, URI uri, HttpEntity entity, boolean compressionEnabled) {
        switch (method.toUpperCase(Locale.ROOT)) {
            case "DELETE":
                return addRequestBody(new HttpDeleteWithEntity(uri), entity, compressionEnabled);
            case "GET":
                return addRequestBody(new HttpGetWithEntity(uri), entity, compressionEnabled);
            case "HEAD":
                return addRequestBody(new HttpHead(uri), entity, compressionEnabled);
            case "OPTIONS":
                return addRequestBody(new HttpOptions(uri), entity, compressionEnabled);
            case "PATCH":
                return addRequestBody(new HttpPatch(uri), entity, compressionEnabled);
            case "POST":
                HttpPost httpPost = new HttpPost(uri);
                addRequestBody(httpPost, entity, compressionEnabled);
                return httpPost;
            case "PUT":
                return addRequestBody(new HttpPut(uri), entity, compressionEnabled);
            case "TRACE":
                return addRequestBody(new HttpTrace(uri), entity, compressionEnabled);
            default:
                throw new UnsupportedOperationException("http method not supported: " + method);
        }
    }
    
}
```

